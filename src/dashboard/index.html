<!--Dark theme per l'intera pagina-->
<html data-bs-theme="dark">

  <head>
    
    <!--Encoding dei caratteri-->
    <meta charset="utf-8" />
    <!--Larghezza adattabile in funzione del device, zoom iniziale=1-->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--Descrizione pagina-->
    <meta name="description" content="Web App" />
    <!--Autori template Bootstrap-->
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors"/>
    <meta name="generator" content="Hugo 0.111.3" />

    <!--Bootstrap Template Carousel-->
    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/carousel/"/>
    <link rel="stylesheet" href="./bootstrap.min.css"/>
    <!--CSS by Carousel Template-->
    <link href="carousel.css" rel="stylesheet" />
    
      
    <!--Page.js per gestire la navigazione all'interno di un'applicazione single-page senza effettuare richieste al server-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/page.js/1.11.6/page.js"></script>

    <!--Personalizzazione della dashboard-->
    <script src="./dashboard.js"></script>
    
    <!--Favicon-->
    <link rel="icon" href="./favicon.ico" />

   
    <!--Jquery-->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>-->
    
    <!--Titolo pagina-->
    <title>Movies Reviews</title>

    <!--Regole di stile by Bootstrap Carousel Template-->
    <style>

      /*Formattazione degli elementi della classe bd-placeholder-img*/
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
   
      /*Formattazione in base alla larghezza della finestra del Browser*/
      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

    </style>
    
  </head>

  <body>
        
    <!--Contenitore flessibile manipolato dinamicamente senza dover ricaricare la pagina con Page.js-->
    <section id="content"></section>
    
    <!--Modal by Bootstrap per Sign In-->
    <div class="modal fade" id="signInModal">
      <!--Determina struttura e posizione nella pagina-->
      <div class="modal-dialog">
        <!--Contenuto-->
        <div class="modal-content">
          <!--Header-->
          <div class="modal-header">
            <h1 class="modal-title" id="signInModalLabel">Get Started</h1>
            <!--Pulsante "x" di chiusura-->
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <!--Body del modal-->
          <div class="modal-body">
            <!--Form per il login, "return false" per eseguire la richiesta, ma il form non invierà i dati al server e la pagina non verrà aggiornata-->
            <form id="signinform" onsubmit="signIn(); return false;">
              <!--Alert per msg di errore-->
              <div
                class="alert alert-danger hide"
                id="alertSignIn"
              ></div>
              <div>
                <input
                  type="text"
                  class="form-control"
                  id="signInUserName"
                  placeholder="Username"
                />
              </div>
              <div>
                <input
                  type="password"
                  class="form-control"
                  id="SignInPassword"
                  placeholder="Password"
                />
              </div>
              <button class="w-100 btn btn-lg btn-primary" type="submit">
                Sign in
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!--Modal by Bootstrap per Sign Up -->
    <div class="modal fade" id="signUpModal">
    <!--Determina struttura e posizione nella pagina-->
      <div class="modal-dialog">
        <!--Contenuto-->
        <div class="modal-content">
          <!--Header-->
          <div class="modal-header">
            <h1 class="modal-title" id="signUpLabel">Get Started</h1>
            <!--Pulsante "x" di chiusura-->
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <!--Body del modal-->
          <div class="modal-body">
            <!--Form per la registrazione, "return false" per eseguire la richiesta, ma il form non invierà i dati al server e la pagina non verrà aggiornata-->
            <form id="signupform" onsubmit="register(); return false;">
              <!--Alert per msg di errore-->
              <div
                class="alert alert-danger hide"
                id="alertSignUp"
              ></div>
              <div>
                <input
                  type="text"
                  class="form-control"
                  id="SignUpNameInput"
                  placeholder="Name"
                />
              </div>
              <div>
                <input
                  type="text"
                  class="form-control"
                  id="SignUpUserNameInput"
                  placeholder="Username"
                />
              </div>
              <div>
                <input
                  type="email"
                  class="form-control"
                  id="SignUpEmailInput"
                  placeholder="name@example.com"
                />
              </div>
              <div>
                <input
                  type="password"
                  class="form-control"
                  id="SignUpPassword"
                  placeholder="Password"
                />
              </div>
              <button class="w-100 btn btn-lg btn-primary" type="submit">
                Submit
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!--Barra di navigazione (Titolo, barra di ricerca, tasti)-->
    <header>
      <!--Navbar che si espande per tutta la larghezza, posizione fissa anche in caso di scrolling-->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <!--Contenitore flessibile per ottimizzare il contenuto della navbar in base alla larghezza del dispositivo-->
        <div class="container-fluid">
          <a class="navbar-brand" href="./">Movies Reviews</a>
          <!--Barra di ricerca-->
          <!--funzione di ricerca richiamata al cambiamento del valore in input (digitazione dell'utente)-->
          <input
            type="text"
            class="form-control w-50"
            list="moviesSearchOptions"
            id="moviesSearchListInput"
            placeholder="Search movies..."
            onchange="onMovieSearchChange(event)"
          />
          <!--Elemento per i suggerimenti di ricerca richiamato nel parametro "list"-->
          <datalist id="moviesSearchOptions"></datalist>
 
          <!--Tasti SignIn, SignUp e Logout(nascosto)-->
          <div id="signInSignupContainer">
            <div id="siginsignupbtns">
              <!--data-bs-target = ID del SignIn Modal-->
              <button
                type="button"
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#SignInModal"
              >
                Sign In
              </button>
              <!--data-bs-target = ID del SignUp Modal-->
              <button
                type="button"
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#SignUpModal"
              >
                Sign Up
              </button>
            </div>

            <!--Tasto nascosto per informazioni utente loggato-->
            <div class="dropdown hide" id="userloginDropdown">
              <button
                class="btn btn-secondary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
              > 
              <span id="accountdetails"></span>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <button class="dropdown-item" onClick="logout()">
                    Logout
                  </button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
    </header>
    
    
    <main>
    <!--Script template. Il tipo "text/x-template" indica al browser che il contenuto del tag <script> non è uno script JavaScript normale, ma un template. Il contenuto all'interno del tag <script> sarà ignorato dal browser quando viene caricato, ma rimarrà disponibile e accessibile attraverso il DOM (Document Object Model) del documento.-->     
      <script id="dashboard" type="text/x-template">
                 
        <!-- SlideShow  -->
        <div id="myCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
          <!--Tasti centrali che indicano la slide attiva. La Slide 0 è la prima visualizzata di default-->
          <div class="carousel-indicators">
            <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1"></button>
          </div>
          <!--Contenuto del Carousel-->
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="bd-placeholder-img" width="100%" height="100%" src="./slide.jpg" />
            </div>

            <div class="carousel-item">
              <img class="bd-placeholder-img" width="100%" height="100%"  src="./slid.jpg" />
            </div>
          </div>
          <!--Tasti di scorrimento (previous e next)-->
          <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>

        <!--Griglia responsive per contenere i film-->
        <div class="album">
          <div class="container">
            <!--2 colonne per piccolo schermo, 5 colonne per grande schermo, margine tra le singole card e movies-content per personalizzare il contenuto-->
            <div class="row row-cols-2 row-cols-lg-5 g-2 g-lg-3 movies-content">
            </div>
          </div>
        </div>
      
      </script>

      
      <!--Script template per contenuto dei singoli film-->
      <script id="movie" type="text/x-template">

        <div class="album">
          <div class="container">
            <!--Una sola colonna per riga indipendentemente dallo schermo-->
            <div class="row row-cols-12 row-cols-lg-12">
              <div class="col-12 d-flex justify-content-center">
                <!--Immagine rappresentativa del singolo film-->
                <div id="single-movie-image-card-container">
                </div>
              </div>
            </div>
            <!--Il contenitore del film-->
            <div class="row row-cols-12 row-cols-lg-12">
                <div class="container-fluid py-5">
                  <h1>About the Movie</h1>
                  <!--Contenitore trama-->
                  <p id="aboutMovie"></p>
                </div>
                <div class="container-fluid py-5">
                  <h1>Cast</h1>
                    <!--Contenitore Cast-->
                    <div id="moviesCastContainer"></div>
                  <!--Contenitore recensioni (invisibile ai visitatori)-->
                <div class="container-fluid py-5" id="moviereviewscontainer">
                    <!--Form per inserimento-->
                    <form id="moviereviewform"></form>
                    <div id="reviewslist"></div>
                </div>
                </div>
            </div>
          </div>
        </div>

      </script>
    </main>
    
    
    <!-- FOOTER -->
    <footer class="container">
      <p class="float-end"><a href="#">Back to top</a></p>
      <p>&copy; 2017-2023 Company, Inc.</p>
    </footer>

    <!--JS by Bootstrap Carousel Template-->
    <script src="./bootstrap.bundle.min.js"></script>


    <!--Utilizzo di Page.js per la navigazione in single page-->
    <script>
      //Percorso base
      page.base("/dashboard");
      //Visualizzo dashboard se path "/"
      page("/", showDashboard);
      //Visualizzo film se path "/id film"
      page("/:id", showMovie);
      //Attivazione del routing single page
      page();

      function showDashboard() {
        
        //Carichiamo il template dashboard nella section con id #content
        var el = document.getElementById("content");
        el.innerHTML = template("dashboard");

        //Parsifichiamo dati user
        const user = JSON.parse(getSessionStorageItem("user"));

        //Se user esiste (se login), rendiamo visibile il tasto personale per il logout
        if (user) {  
          document.getElementById("siginsignupbtns").style.display = "none";
          const { username } = user;
          const accountdetails = document.getElementById("accountdetails");
          accountdetails.innerHTML = `Hi ${username}`;
          const userloginDropdown = document.getElementById("userloginDropdown");
          userloginDropdown.classList.remove("hide");
        } 

        //Promise
        getMoviesList("http://localhost:5000/webapp/api/getAllMovies",user, "GET").then((movies) => {
            
                renderMoviesData(movies.data);
                setSessionStorageItem("movies", JSON.stringify(movies.data));
                renderAutosuggestMovies();
            });
      }


      
      
      
      function showMovie(ctx) {
        
        const user = JSON.parse(getSessionStorageItem("user"));
       
        //Promise
        getMovie(`http://localhost:5000/webapp/api/getMovie/${ctx.params.id}`, user,"GET").then((movieData) => {
            
              renderMovieData(movieData.data);
              setSessionStorageItem("movie", JSON.stringify(movieData.data));
        });
      
        
        var el = document.getElementById("content");
        el.innerHTML = template("movie");
      }

      
      
      /*Restituisce il contenuto HTML di un elemento identificato da ID "name", mi permette di gestire dinamicamente i due script template*/
      function template(name) {
        return document.getElementById(name).innerHTML;
      }
    </script>
       
  </body>
</html>
